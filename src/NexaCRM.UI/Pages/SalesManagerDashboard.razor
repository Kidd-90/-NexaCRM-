@page "/sales-manager-dashboard"
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.Extensions.Localization
@attribute [Authorize(Roles = "Admin,Manager")]
@inject IStringLocalizer<SalesManagerDashboard> Localizer
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<div class="relative flex size-full min-h-screen flex-col bg-slate-50 group/design-root overflow-x-hidden">
      <div class="layout-container flex h-full grow flex-col">
        
        <!-- Mobile Navigation Overlay -->
        <div class="mobile-nav-overlay @(isMobileMenuOpen ? "active" : "")" @onclick="CloseMobileMenu">
        </div>
        
        <!-- Mobile Navigation Menu -->
        <nav class="mobile-nav-menu @(isMobileMenuOpen ? "active" : "")">
          <button class="mobile-nav-close" @onclick="CloseMobileMenu">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
          <ul class="mobile-nav-links">
            <li><a class="mobile-nav-link" href="/main-dashboard" @onclick="CloseMobileMenu">@Localizer["Dashboard"]</a></li>
            <li><a class="mobile-nav-link" href="/sales-pipeline-page" @onclick="CloseMobileMenu">@Localizer["Deals"]</a></li>
            <li><a class="mobile-nav-link" href="/contacts" @onclick="CloseMobileMenu">@Localizer["Contacts"]</a></li>
            <li><a class="mobile-nav-link" href="/reports-page" @onclick="CloseMobileMenu">@Localizer["Reports"]</a></li>
            <li><a class="mobile-nav-link" href="/tools" @onclick="CloseMobileMenu">@Localizer["Tools"]</a></li>
          </ul>
        </nav>
        
        <div class="dashboard-main-container px-4 sm:px-6 md:px-12 lg:px-40 flex flex-1 justify-center py-5">
          <div class="layout-content-container flex flex-col w-full max-w-none sm:max-w-full md:max-w-[960px] flex-1">
            <div class="flex flex-wrap justify-between gap-3 p-4">
              <div class="flex w-full sm:min-w-72 flex-col gap-3">
                <AuthorizeView>
                    <Authorized>
                        <p class="text-[#0e131b] tracking-light text-xl sm:text-2xl lg:text-[32px] font-bold leading-tight">@Localizer["Welcome", @context.User.Identity?.Name ?? ""]</p>
                    </Authorized>
                </AuthorizeView>
                <p class="text-[#4d6a99] text-sm font-normal leading-normal">@Localizer["Overview"]</p>
              </div>
            </div>
            <div class="flex gap-2 sm:gap-3 p-3 flex-wrap pr-4 overflow-x-auto">
              <button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#e7ecf3] pl-3 sm:pl-4 pr-2 text-xs sm:text-sm">
                <p class="text-[#0e131b] font-medium leading-normal">@Localizer["Team"]</p>
                <div class="text-[#0e131b]" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
              <button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#e7ecf3] pl-3 sm:pl-4 pr-2 text-xs sm:text-sm">
                <p class="text-[#0e131b] font-medium leading-normal">@Localizer["TimePeriod"]</p>
                <div class="text-[#0e131b]" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
              <button class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-lg bg-[#e7ecf3] pl-3 sm:pl-4 pr-2 text-xs sm:text-sm">
                <p class="text-[#0e131b] font-medium leading-normal">@Localizer["Product"]</p>
                <div class="text-[#0e131b]" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
            </div>
            <div class="stats-container flex flex-wrap gap-3 sm:gap-4 p-4">
              <div class="stat-card flex min-w-[140px] sm:min-w-[158px] flex-1 flex-col gap-2 rounded-lg p-4 sm:p-6 bg-[#e7ecf3]">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["TotalSales"]</p>
                <p class="text-[#0e131b] tracking-light text-xl sm:text-2xl font-bold leading-tight">$2.5M</p>
              </div>
              <div class="stat-card flex min-w-[140px] sm:min-w-[158px] flex-1 flex-col gap-2 rounded-lg p-4 sm:p-6 bg-[#e7ecf3]">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["SalesPipelineValue"]</p>
                <p class="text-[#0e131b] tracking-light text-xl sm:text-2xl font-bold leading-tight">$1.2M</p>
              </div>
              <div class="stat-card flex min-w-[140px] sm:min-w-[158px] flex-1 flex-col gap-2 rounded-lg p-4 sm:p-6 bg-[#e7ecf3]">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["WinRate"]</p>
                <p class="text-[#0e131b] tracking-light text-xl sm:text-2xl font-bold leading-tight">65%</p>
              </div>
              <div class="stat-card flex min-w-[140px] sm:min-w-[158px] flex-1 flex-col gap-2 rounded-lg p-4 sm:p-6 bg-[#e7ecf3]">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["AverageDealSize"]</p>
                <p class="text-[#0e131b] tracking-light text-xl sm:text-2xl font-bold leading-tight">$15K</p>
              </div>
            </div>
            <h2 class="text-[#0e131b] text-lg sm:text-xl md:text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">@Localizer["TeamPerformance"]</h2>
            <div class="flex flex-wrap gap-4 px-4 py-6">
              <div class="chart-container flex w-full md:min-w-72 flex-1 flex-col gap-2 rounded-lg border border-[#d0d9e7] p-4 sm:p-6">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["SalesByTeamMember"]</p>
                <div class="grid min-h-[150px] sm:min-h-[180px] grid-flow-col gap-3 sm:gap-6 grid-rows-[1fr_auto] items-end justify-items-center px-1 sm:px-3">
                  <div class="border-[#4d6a99] bg-[#e7ecf3] border-t-2 w-full" style="height: 50%;"></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Alex"]</p>
                  <div class="border-[#4d6a99] bg-[#e7ecf3] border-t-2 w-full" style="height: 100%;"></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Jordan"]</p>
                  <div class="border-[#4d6a99] bg-[#e7ecf3] border-t-2 w-full" style="height: 100%;"></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Taylor"]</p>
                  <div class="border-[#4d6a99] bg-[#e7ecf3] border-t-2 w-full" style="height: 90%;"></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Casey"]</p>
                  <div class="border-[#4d6a99] bg-[#e7ecf3] border-t-2 w-full" style="height: 100%;"></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Morgan"]</p>
                </div>
              </div>
            </div>
            <h2 class="text-[#0e131b] text-lg sm:text-xl md:text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">@Localizer["SalesPipeline"]</h2>
            <div class="flex flex-wrap gap-4 px-4 py-6">
              <div class="chart-container flex w-full md:min-w-72 flex-1 flex-col gap-2 rounded-lg border border-[#d0d9e7] p-4 sm:p-6">
                <p class="text-[#0e131b] text-sm sm:text-base font-medium leading-normal">@Localizer["PipelineStages"]</p>
                <div class="grid min-h-[150px] sm:min-h-[180px] gap-x-2 sm:gap-x-4 gap-y-4 sm:gap-y-6 grid-cols-[auto_1fr] items-center py-3">
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Prospecting"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 100%;"></div></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Qualification"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 20%;"></div></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Proposal"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 20%;"></div></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["Negotiation"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 30%;"></div></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["ClosedWon"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 10%;"></div></div>
                  <p class="text-[#4d6a99] text-xs font-bold leading-normal tracking-[0.015em]">@Localizer["ClosedLost"]</p>
                  <div class="h-full flex-1"><div class="border-[#4d6a99] bg-[#e7ecf3] border-r-2 h-full" style="width: 90%;"></div></div>
                </div>
              </div>
            </div>
            <h2 class="text-[#0e131b] text-lg sm:text-xl md:text-[22px] font-bold leading-tight tracking-[-0.015em] px-4 pb-3 pt-5">@Localizer["TopPerformers"]</h2>
            
            <!-- Desktop/Tablet Table View -->
            <div class="performance-table-container px-4 py-3 container">
              <div class="flex overflow-hidden rounded-lg border border-[#d0d9e7] bg-slate-50 overflow-x-auto">
                <table class="flex-1 min-w-full">
                  <thead>
                    <tr class="bg-slate-50">
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 px-2 sm:px-4 py-3 text-left text-[#0e131b] text-xs sm:text-sm font-medium leading-normal">@Localizer["Rank"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 px-2 sm:px-4 py-3 text-left text-[#0e131b] text-xs sm:text-sm font-medium leading-normal">@Localizer["Name"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 px-2 sm:px-4 py-3 text-left text-[#0e131b] text-xs sm:text-sm font-medium leading-normal">@Localizer["Sales"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 px-2 sm:px-4 py-3 text-left text-[#0e131b] text-xs sm:text-sm font-medium leading-normal">
                        @Localizer["DealsWon"]
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-t border-t-[#d0d9e7]">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">1</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#0e131b] text-xs sm:text-sm font-normal leading-normal">@Localizer["Alex"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">$600K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">40</td>
                    </tr>
                    <tr class="border-t border-t-[#d0d9e7]">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">2</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#0e131b] text-xs sm:text-sm font-normal leading-normal">@Localizer["Jordan"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">$550K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">35</td>
                    </tr>
                    <tr class="border-t border-t-[#d0d9e7]">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">3</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#0e131b] text-xs sm:text-sm font-normal leading-normal">@Localizer["Taylor"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">$500K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">30</td>
                    </tr>
                    <tr class="border-t border-t-[#d0d9e7]">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">4</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#0e131b] text-xs sm:text-sm font-normal leading-normal">@Localizer["Casey"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">$450K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">25</td>
                    </tr>
                    <tr class="border-t border-t-[#d0d9e7]">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">5</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#0e131b] text-xs sm:text-sm font-normal leading-normal">@Localizer["Morgan"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">$400K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 h-[60px] sm:h-[72px] px-2 sm:px-4 py-2 text-[#4d6a99] text-xs sm:text-sm font-normal leading-normal">20</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Mobile Card View -->
            <div class="performance-mobile-view px-4 py-3">
              <div class="performance-card">
                <div class="performance-card-rank">#1</div>
                <div class="performance-card-name">@Localizer["Alex"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$600K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">40</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#2</div>
                <div class="performance-card-name">@Localizer["Jordan"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$550K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">35</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#3</div>
                <div class="performance-card-name">@Localizer["Taylor"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$500K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">30</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#4</div>
                <div class="performance-card-name">@Localizer["Casey"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$450K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">25</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#5</div>
                <div class="performance-card-name">@Localizer["Morgan"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$400K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">20</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Quick Actions Floating Button -->
    <NexaCRM.UI.Components.UI.FloatingActionButton 
        ShowCallAction="true" 
        ShowEmailAction="true" 
        ShowMeetingAction="true" 
        ShowAddAction="true"
        OnActionClicked="HandleFloatingAction" />

@code {
    private bool isMobileMenuOpen = false;

    private void ToggleMobileMenu()
    {
        isMobileMenuOpen = !isMobileMenuOpen;
    }

    private void CloseMobileMenu()
    {
        isMobileMenuOpen = false;
    }

    private void HandleFloatingAction(string action)
    {
        switch (action)
        {
            case "call":
                // Navigate to contacts page to select a contact to call
                NavigationManager.NavigateTo("/contacts");
                break;
            case "email":
                // Navigate to contacts page to select a contact to email
                NavigationManager.NavigateTo("/contacts");
                break;
            case "meeting":
                // Navigate to calendar/meeting scheduling
                NavigationManager.NavigateTo("/sales-calendar");
                break;
            case "add":
                // Navigate to add new lead/opportunity page
                NavigationManager.NavigateTo("/sales-pipeline-page");
                break;
        }
    }
}
