@page "/sales-manager-dashboard"
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.Extensions.Localization
@attribute [Authorize(Roles = "Admin,Manager")]
@inject IStringLocalizer<SalesManagerDashboard> Localizer
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager

<div class="position-relative d-flex min-vh-100 flex-column bg-surface-soft overflow-x-hidden">
      <div class="layout-container d-flex h-100 flex-grow-1 flex-column">
        
        <!-- Mobile Navigation Overlay -->
        <div class="mobile-nav-overlay @(isMobileMenuOpen ?"active" : "")" @onclick="CloseMobileMenu">
        </div>
        
        <!-- Mobile Navigation Menu -->
        <nav class="mobile-nav-menu @(isMobileMenuOpen ?"active" : "")">
          <button class="mobile-nav-close" @onclick="CloseMobileMenu">
            <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
          <ul class="mobile-nav-links">
            <li><a class="mobile-nav-link" href="/main-dashboard" @onclick="CloseMobileMenu">@Localizer["Dashboard"]</a></li>
            <li><a class="mobile-nav-link" href="/sales-pipeline-page" @onclick="CloseMobileMenu">@Localizer["Deals"]</a></li>
            <li><a class="mobile-nav-link" href="/contacts" @onclick="CloseMobileMenu">@Localizer["Contacts"]</a></li>
            <li><a class="mobile-nav-link" href="/reports-page" @onclick="CloseMobileMenu">@Localizer["Reports"]</a></li>
            <li><a class="mobile-nav-link" href="/tools" @onclick="CloseMobileMenu">@Localizer["Tools"]</a></li>
          </ul>
        </nav>
        
        <div class="dashboard-main-container px-4 d-flex flex-grow-1 justify-content-center py-5">
          <div class="layout-content-container d-flex flex-column w-100 max-w-none flex-grow-1">
            <div class="d-flex flex-wrap justify-content-between gap-3 p-4">
              <div class="d-flex w-100 flex-column gap-3">
                <AuthorizeView>
                    <Authorized>
                        <p class="text-ink fs-3 fw-bold lh-sm">@Localizer["Welcome", @context.User.Identity?.Name ?? ""]</p>
                    </Authorized>
                </AuthorizeView>
                <p class="text-ink-muted small fw-normal lh-base">@Localizer["Overview"]</p>
              </div>
            </div>
            <div class="d-flex gap-2 p-3 flex-wrap pr-4 overflow-x-auto">
              <button class="d-flex ui-input-height-sm shrink-0 align-items-center justify-content-center gx-2 rounded-3 bg-accent-soft pl-3 pr-2 small">
                <p class="text-ink fw-semibold lh-base">@Localizer["Team"]</p>
                <div class="text-ink" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
              <button class="d-flex ui-input-height-sm shrink-0 align-items-center justify-content-center gx-2 rounded-3 bg-accent-soft pl-3 pr-2 small">
                <p class="text-ink fw-semibold lh-base">@Localizer["TimePeriod"]</p>
                <div class="text-ink" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
              <button class="d-flex ui-input-height-sm shrink-0 align-items-center justify-content-center gx-2 rounded-3 bg-accent-soft pl-3 pr-2 small">
                <p class="text-ink fw-semibold lh-base">@Localizer["Product"]</p>
                <div class="text-ink" data-icon="CaretDown" data-size="16px" data-weight="regular">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16px" height="16px" fill="currentColor" viewBox="0 0 256 256">
                    <path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path>
                  </svg>
                </div>
              </button>
            </div>
            <div class="stats-container d-flex flex-wrap gap-3 p-4">
              <div class="stat-card d-flex ui-min-w-140 flex-grow-1 flex-column gap-2 rounded-3 p-4 bg-accent-soft">
                <p class="text-ink small fw-semibold lh-base">@Localizer["TotalSales"]</p>
                <p class="text-ink fs-3 fw-bold lh-sm">$2.5M</p>
              </div>
              <div class="stat-card d-flex ui-min-w-140 flex-grow-1 flex-column gap-2 rounded-3 p-4 bg-accent-soft">
                <p class="text-ink small fw-semibold lh-base">@Localizer["SalesPipelineValue"]</p>
                <p class="text-ink fs-3 fw-bold lh-sm">$1.2M</p>
              </div>
              <div class="stat-card d-flex ui-min-w-140 flex-grow-1 flex-column gap-2 rounded-3 p-4 bg-accent-soft">
                <p class="text-ink small fw-semibold lh-base">@Localizer["WinRate"]</p>
                <p class="text-ink fs-3 fw-bold lh-sm">65%</p>
              </div>
              <div class="stat-card d-flex ui-min-w-140 flex-grow-1 flex-column gap-2 rounded-3 p-4 bg-accent-soft">
                <p class="text-ink small fw-semibold lh-base">@Localizer["AverageDealSize"]</p>
                <p class="text-ink fs-3 fw-bold lh-sm">$15K</p>
              </div>
            </div>
            <h2 class="text-ink fs-4 fw-bold lh-sm px-4 pb-3 pt-5">@Localizer["TeamPerformance"]</h2>
            <div class="d-flex flex-wrap gap-4 px-4 py-4">
              <div class="chart-container d-flex w-100 flex-grow-1 flex-column gap-2 rounded-3 border border-soft p-4">
                <p class="text-ink small fw-semibold lh-base">@Localizer["SalesByTeamMember"]</p>
                <div class="d-grid ui-min-h-150 ui-grid-flow-col gap-3 ui-grid-rows align-items-end justify-items-center px-1">
                  <div class="border border-primary bg-accent-soft border-top border-2 w-100" style="height: 50%;"></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Alex"]</p>
                  <div class="border border-primary bg-accent-soft border-top border-2 w-100" style="height: 100%;"></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Jordan"]</p>
                  <div class="border border-primary bg-accent-soft border-top border-2 w-100" style="height: 100%;"></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Taylor"]</p>
                  <div class="border border-primary bg-accent-soft border-top border-2 w-100" style="height: 90%;"></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Casey"]</p>
                  <div class="border border-primary bg-accent-soft border-top border-2 w-100" style="height: 100%;"></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Morgan"]</p>
                </div>
              </div>
            </div>
            <h2 class="text-ink fs-4 fw-bold lh-sm px-4 pb-3 pt-5">@Localizer["SalesPipeline"]</h2>
            <div class="d-flex flex-wrap gap-4 px-4 py-4">
              <div class="chart-container d-flex w-100 flex-grow-1 flex-column gap-2 rounded-3 border border-soft p-4">
                <p class="text-ink small fw-semibold lh-base">@Localizer["PipelineStages"]</p>
                <div class="d-grid ui-min-h-150 gx-2 gy-3 ui-grid-auto-1fr align-items-center py-3">
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Prospecting"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 100%;"></div></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Qualification"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 20%;"></div></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Proposal"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 20%;"></div></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["Negotiation"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 30%;"></div></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["ClosedWon"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 10%;"></div></div>
                  <p class="text-ink-muted small fw-bold lh-base">@Localizer["ClosedLost"]</p>
                  <div class="h-100 flex-grow-1"><div class="border border-primary bg-accent-soft border-end border-2 h-100" style="width: 90%;"></div></div>
                </div>
              </div>
            </div>
            <h2 class="text-ink fs-4 fw-bold lh-sm px-4 pb-3 pt-5">@Localizer["TopPerformers"]</h2>
            
            <!-- Desktop/Tablet Table View -->
            <div class="performance-table-container px-4 py-3 container">
              <div class="d-flex overflow-hidden rounded-3 border border-soft bg-surface-soft overflow-x-auto">
                <table class="flex-grow-1 min-w-full">
                  <thead>
                    <tr class="bg-surface-soft">
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 px-2 py-3 text-start text-ink small fw-semibold lh-base">@Localizer["Rank"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 px-2 py-3 text-start text-ink small fw-semibold lh-base">@Localizer["Name"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 px-2 py-3 text-start text-ink small fw-semibold lh-base">@Localizer["Sales"]</th>
                      <th class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 px-2 py-3 text-start text-ink small fw-semibold lh-base">
                        @Localizer["DealsWon"]
                      </th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="border-top border-soft">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">1</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 ui-height-60 px-2 py-2 text-ink small fw-normal lh-base">@Localizer["Alex"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">$600K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">40</td>
                    </tr>
                    <tr class="border-top border-soft">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">2</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 ui-height-60 px-2 py-2 text-ink small fw-normal lh-base">@Localizer["Jordan"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">$550K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">35</td>
                    </tr>
                    <tr class="border-top border-soft">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">3</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 ui-height-60 px-2 py-2 text-ink small fw-normal lh-base">@Localizer["Taylor"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">$500K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">30</td>
                    </tr>
                    <tr class="border-top border-soft">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">4</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 ui-height-60 px-2 py-2 text-ink small fw-normal lh-base">@Localizer["Casey"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">$450K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">25</td>
                    </tr>
                    <tr class="border-top border-soft">
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-120 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">5</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-240 ui-height-60 px-2 py-2 text-ink small fw-normal lh-base">@Localizer["Morgan"]</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-360 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">$400K</td>
                      <td class="table-90e7711b-05e4-42bf-8822-e250d5edb30e-column-480 ui-height-60 px-2 py-2 text-ink-muted small fw-normal lh-base">20</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Mobile Card View -->
            <div class="performance-mobile-view px-4 py-3">
              <div class="performance-card">
                <div class="performance-card-rank">#1</div>
                <div class="performance-card-name">@Localizer["Alex"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$600K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">40</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#2</div>
                <div class="performance-card-name">@Localizer["Jordan"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$550K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">35</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#3</div>
                <div class="performance-card-name">@Localizer["Taylor"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$500K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">30</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#4</div>
                <div class="performance-card-name">@Localizer["Casey"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$450K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">25</div>
                  </div>
                </div>
              </div>
              
              <div class="performance-card">
                <div class="performance-card-rank">#5</div>
                <div class="performance-card-name">@Localizer["Morgan"]</div>
                <div class="performance-card-stats">
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["Sales"]</div>
                    <div class="performance-stat-value">$400K</div>
                  </div>
                  <div class="performance-stat">
                    <div class="performance-stat-label">@Localizer["DealsWon"]</div>
                    <div class="performance-stat-value">20</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Mobile Quick Actions Floating Button -->
    <NexaCRM.UI.Components.UI.FloatingActionButton 
        ShowCallAction="true" 
        ShowEmailAction="true" 
        ShowMeetingAction="true" 
        ShowAddAction="true"
        OnActionClicked="HandleFloatingAction" />

@code {
    private bool isMobileMenuOpen = false;

    private void ToggleMobileMenu()
    {
        isMobileMenuOpen = !isMobileMenuOpen;
    }

    private void CloseMobileMenu()
    {
        isMobileMenuOpen = false;
    }

    private void HandleFloatingAction(string action)
    {
        switch (action)
        {
            case "call":
                // Navigate to contacts page to select a contact to call
                NavigationManager.NavigateTo("/contacts");
                break;
            case "email":
                // Navigate to contacts page to select a contact to email
                NavigationManager.NavigateTo("/contacts");
                break;
            case "meeting":
                // Navigate to calendar/meeting scheduling
                NavigationManager.NavigateTo("/sales-calendar");
                break;
            case "add":
                // Navigate to add new lead/opportunity page
                NavigationManager.NavigateTo("/sales-pipeline-page");
                break;
        }
    }
}
