@page "/demo-contacts"
@using Microsoft.Extensions.Localization
@using NexaCRM.UI.Services.Interfaces
@inject IStringLocalizer<ContactsPage> Localizer
@inject NavigationManager NavigationManager
@inject IGlobalActionService GlobalActionService

<div class="position-relative d-flex min-vh-100 flex-column bg-surface-soft overflow-x-hidden">
    <div class="layout-container d-flex h-100 flex-grow-1 flex-column">
        <header class="contacts-header d-flex flex-wrap align-items-center justify-content-between gap-3 border-bottom border border-soft px-4 py-3">
            <div class="d-flex align-items-center gap-4">
                <div class="d-flex align-items-center gap-4 text-ink">
                    <h2 class="text-ink small fw-bold lh-sm">Demo Contacts with Quick Actions</h2>
                </div>
            </div>
        </header>
        
        <div class="px-4 d-flex flex-grow-1 justify-content-center py-5">
            <div class="layout-content-container d-flex flex-column w-100 max-w-none flex-grow-1">
                <div class="contacts-header">
                    <h1 class="contacts-title fs-2 fw-bold mb-4">Demo Contacts</h1>
                    <p class="text-secondary mb-6">This demonstrates the QuickActions component integrated with contact management</p>
                </div>

                <!-- Desktop/Tablet Table View -->
                <div class="contacts-table-container overflow-x-auto -mx-4">
                    <div class="inline-block min-w-full align-middle">
                        <table class="contacts-table min-w-full divide-y divide-gray-200 bg-white rounded-3 overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Name
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Email
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Phone
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Quick Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                @foreach (var contact in demoContacts)
                                {
                                    <tr class="transition-colors duration-200">
                                        <td class="px-3 py-4 text-nowrap small fw-semibold text-dark">
                                            @contact.Name
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark">
                                            <a href="mailto:@contact.Email" class="text-primary break-all">
                                                @contact.Email
                                            </a>
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark">
                                            <a href="tel:@contact.Phone" class="text-primary">
                                                @contact.Phone
                                            </a>
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark">
                                            <NexaCRM.UI.Components.UI.QuickActionsComponent 
                                                PhoneNumber="@contact.Phone"
                                                Email="@contact.Email"
                                                CustomerName="@contact.Name"
                                                CustomerId="@contact.Id.ToString()"
                                                ShowLabels="false"
                                                CssClass="inline"
                                                OnActionCompleted="HandleQuickAction" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Mobile Card View -->
                <div class="contacts-mobile-view">
                    @foreach (var contact in demoContacts)
                    {
                        <div class="contact-card">
                            <div class="contact-name">
                                @contact.Name
                            </div>
                            <div class="contact-id">ID: @contact.Id</div>
                            
                            <div class="contact-info">
                                <div class="contact-info-item">
                                    <svg class="contact-info-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                    </svg>
                                    <div class="contact-info-content">
                                        <div class="contact-info-label">Email</div>
                                        <div class="contact-info-value">
                                            <a href="mailto:@contact.Email">@contact.Email</a>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="contact-info-item">
                                    <svg class="contact-info-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                    <div class="contact-info-content">
                                        <div class="contact-info-label">Phone</div>
                                        <div class="contact-info-value">
                                            <a href="tel:@contact.Phone">@contact.Phone</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quick Actions for Mobile -->
                            <div class="contact-actions">
                                <NexaCRM.UI.Components.UI.QuickActionsComponent 
                                    PhoneNumber="@contact.Phone"
                                    Email="@contact.Email"
                                    CustomerName="@contact.Name"
                                    CustomerId="@contact.Id.ToString()"
                                    ShowLabels="true"
                                    CssClass=""
                                    OnActionCompleted="HandleQuickAction" />
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Quick Actions Floating Button -->
    <NexaCRM.UI.Components.UI.FloatingActionButton 
        ShowCallAction="true" 
        ShowEmailAction="true" 
        ShowMeetingAction="true" 
        ShowAddAction="true"
        OnActionClicked="HandleFloatingAction" />
</div>

@code {
    private List<DemoContact> demoContacts = new List<DemoContact>
    {
        new DemoContact { Id = 1, Name = "John Smith", Email = "john.smith@company.com", Phone = "+1-555-123-4567" },
        new DemoContact { Id = 2, Name = "Sarah Johnson", Email = "sarah.j@business.com", Phone = "+1-555-234-5678" },
        new DemoContact { Id = 3, Name = "Michael Chen", Email = "m.chen@enterprise.net", Phone = "+1-555-345-6789" },
        new DemoContact { Id = 4, Name = "Emily Rodriguez", Email = "emily.r@startup.io", Phone = "+1-555-456-7890" },
        new DemoContact { Id = 5, Name = "David Wilson", Email = "d.wilson@corporation.com", Phone = "+1-555-567-8901" }
    };

    public class DemoContact
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
    }

    private void HandleQuickAction(string action)
    {
        // This method is called when quick action buttons are clicked
        // The actual call/email/meeting functionality is handled within the QuickActionsComponent
        Console.WriteLine($"Quick action executed: {action}");
    }

    private async System.Threading.Tasks.Task HandleFloatingAction(string action)
    {
        var request = action switch
        {
            "call" => new GlobalActionRequest(GlobalActionType.Call),
            "email" => new GlobalActionRequest(GlobalActionType.Email),
            "meeting" => new GlobalActionRequest(GlobalActionType.ScheduleMeeting),
            "add" => new GlobalActionRequest(GlobalActionType.AddContact),
            _ => null
        };

        if (request is null)
        {
            return;
        }

        await GlobalActionService.LaunchAsync(request);
    }
}