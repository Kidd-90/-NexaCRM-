@page "/demo-contacts"
@using Microsoft.Extensions.Localization
@using NexaCRM.UI.Services.Interfaces
@inject IStringLocalizer<ContactsPage> Localizer
@inject NavigationManager NavigationManager
@inject IGlobalActionService GlobalActionService

<div class="position-relative d-flex min-vh-100 flex-column bg-surface-soft overflow-x-hidden">
    <div class="layout-container d-flex h-100 flex-grow-1 flex-column">
        <header class="contacts-header d-flex flex-wrap align-items-center justify-content-between gap-3 border-bottom border border-soft px-4 py-3">
            <div class="d-flex align-items-center gap-4">
                <div class="d-flex align-items-center gap-4 text-ink">
                    <h2 class="text-ink small fw-bold lh-sm">Demo Contacts with Quick Actions</h2>
                </div>
            </div>
        </header>
        
        <div class="px-4 d-flex flex-grow-1 justify-content-center py-5">
            <div class="layout-content-container d-flex flex-column w-100 max-w-none flex-grow-1">
                <div class="contacts-header">
                    <h1 class="contacts-title fs-2 fw-bold mb-4">Demo Contacts</h1>
                    <p class="text-secondary mb-6">This demonstrates the QuickActions component integrated with contact management</p>
                </div>

                <div class="contacts-table-container overflow-x-auto -mx-4">
                    <div class="inline-block min-w-full align-middle">
                        <table class="contacts-table min-w-full divide-y divide-gray-200 bg-white rounded-3 overflow-hidden responsive-table">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Name
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Email
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Phone
                                    </th>
                                    <th class="px-3 py-3 text-start small fw-semibold text-secondary uppercase">
                                        Quick Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                @foreach (var contact in demoContacts)
                                {
                                    <tr class="transition-colors duration-200">
                                        <td class="px-3 py-4 text-nowrap small fw-semibold text-dark" data-label="Name">
                                            @contact.Name
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark" data-label="Email">
                                            <a href="mailto:@contact.Email" class="text-primary break-all">
                                                @contact.Email
                                            </a>
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark" data-label="Phone">
                                            <a href="tel:@contact.Phone" class="text-primary">
                                                @contact.Phone
                                            </a>
                                        </td>
                                        <td class="px-3 py-4 text-nowrap small text-dark" data-label="Quick Actions">
                                            <NexaCRM.UI.Components.UI.QuickActionsComponent
                                                PhoneNumber="@contact.Phone"
                                                Email="@contact.Email"
                                                CustomerName="@contact.Name"
                                                CustomerId="@contact.Id.ToString()"
                                                ShowLabels="false"
                                                CssClass="inline"
                                                OnActionCompleted="HandleQuickAction" />
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
    
    <!-- Mobile Quick Actions Floating Button -->
    <NexaCRM.UI.Components.UI.FloatingActionButton 
        ShowCallAction="true" 
        ShowEmailAction="true" 
        ShowMeetingAction="true" 
        ShowAddAction="true"
        OnActionClicked="HandleFloatingAction" />
</div>

@code {
    private List<DemoContact> demoContacts = new List<DemoContact>
    {
        new DemoContact { Id = 1, Name = "John Smith", Email = "john.smith@company.com", Phone = "+1-555-123-4567" },
        new DemoContact { Id = 2, Name = "Sarah Johnson", Email = "sarah.j@business.com", Phone = "+1-555-234-5678" },
        new DemoContact { Id = 3, Name = "Michael Chen", Email = "m.chen@enterprise.net", Phone = "+1-555-345-6789" },
        new DemoContact { Id = 4, Name = "Emily Rodriguez", Email = "emily.r@startup.io", Phone = "+1-555-456-7890" },
        new DemoContact { Id = 5, Name = "David Wilson", Email = "d.wilson@corporation.com", Phone = "+1-555-567-8901" }
    };

    public class DemoContact
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Email { get; set; } = string.Empty;
        public string Phone { get; set; } = string.Empty;
    }

    private void HandleQuickAction(string action)
    {
        // This method is called when quick action buttons are clicked
        // The actual call/email/meeting functionality is handled within the QuickActionsComponent
        Console.WriteLine($"Quick action executed: {action}");
    }

    private async System.Threading.Tasks.Task HandleFloatingAction(string action)
    {
        var request = action switch
        {
            "call" => new GlobalActionRequest(GlobalActionType.Call),
            "email" => new GlobalActionRequest(GlobalActionType.Email),
            "meeting" => new GlobalActionRequest(GlobalActionType.ScheduleMeeting),
            "add" => new GlobalActionRequest(GlobalActionType.AddContact),
            _ => null
        };

        if (request is null)
        {
            return;
        }

        await GlobalActionService.LaunchAsync(request);
    }
}