@inherits LayoutComponentBase
@inject IJSRuntime JSRuntime
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject INotificationFeedService NotificationFeed
@inject IDeviceService DeviceService

<HeadContent>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-iconic@1.1.1/font/css/open-iconic-bootstrap.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" />
    <link rel="stylesheet" href="_content/NexaCRM.UI/css/app.css" />
    <link rel="stylesheet" href="_content/NexaCRM.UI/css/ui/index.css" />
    <link rel="stylesheet" href="_content/NexaCRM.UI/css/components/login-status.css" />
    <link rel="stylesheet" href="_content/NexaCRM.UI/css/overrides.css" />
    <script>
        (function () {
            try {
                if (!document.querySelector('.page.desktop-layout')) {
                    var resp = document.querySelector('.responsive-page');
                    if (resp && resp.parentNode) {
                        var wrapper = document.createElement('div');
                        wrapper.className = 'page desktop-layout desktop-shell';
                        resp.parentNode.insertBefore(wrapper, resp);
                        wrapper.appendChild(resp);
                        try { console.log('[layout-guard] injected .page.desktop-layout wrapper'); } catch (e) {}
                    }
                }
            } catch (e) {
                try { console.warn('[layout-guard] failed', e); } catch (e) {}
            }
        })();

        (function () {
            if (window.__nexacrm_ui_scripts_loaded) return;
            window.__nexacrm_ui_scripts_loaded = true;

            var base = '/_content/NexaCRM.UI/js/';
            var files = [
                'device.js',
                'auth-manager.js',
                'navigation.js',
                'culture.js',
                'theme-manager.js',
                'interactions.js',
                'client-console-forwarder.js',
                'csv-export.js',
                'actions.js',
            ];

            files.forEach(function (file) {
                var rel = base + file;
                var selector = 'script[src="' + rel + '"], script[src="' + rel.replace(/^\//, '') + '"]';
                if (document.querySelector(selector)) return;
                var s = document.createElement('script');
                s.src = rel;
                s.defer = true;
                document.head.appendChild(s);
            });
        })();
    </script>
</HeadContent>

@if (ShouldRenderMobileShell)
{
    <MobileShell DevicePlatformToken="@GetDevicePlatformToken()"
                 BodyContent="@Body"
                 UserDisplayName="@userDisplayName"
                 UserInitials="@userInitials"
                 CurrentPageTitle="@currentPageTitle"
                 UnreadNotificationsCount="@unreadNotificationsCount"
                 ShowBackButton="@isDetailPage"
                 OnNavigateBack="NavigateBack"
                 OnNotificationsClick="OnNotificationsClick"
                 NavigationItems="@mobileNavigationLinks"
                 OnNavigateTo="NavigateToMobile" />
}
else
{
    <DesktopShell DevicePlatformToken="@GetDevicePlatformToken()"
                  BodyContent="@Body"
                  HeaderActionIcon="@headerActionIcon"
                  CurrentPageTitle="@currentPageTitle"
                  IsDetailPage="@isDetailPage"
                  ParentPageTitle="@parentPageTitle"
                  OnNavigateBack="NavigateBack"
                  OnNotificationsClick="OnNotificationsClick"
                  OnSearchNavigate="HandleSearchNavigate"
                  UnreadNotificationsCount="@unreadNotificationsCount"
                  UserInitials="@userInitials"
                  DecorateAsMobile="@ShouldDecorateAsMobileChrome" />
}

<GlobalActionHost />
