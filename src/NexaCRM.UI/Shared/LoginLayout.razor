@inherits LayoutComponentBase

<HeadContent>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/open-iconic@1.1.1/font/css/open-iconic-bootstrap.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pretendard/dist/web/variable/pretendardvariable.css" />
    <link rel="stylesheet" href="/_content/NexaCRM.UI/css/app.css" />
    <link rel="stylesheet" href="/_content/NexaCRM.UI/css/ui/index.css" />
    <script>
        (function () {
            if (window.__nexacrm_ui_scripts_loaded) return;
            window.__nexacrm_ui_scripts_loaded = true;

            var base = '/_content/NexaCRM.UI/js/';
            var files = [
                'auth-manager.js',
                'navigation.js',
                'culture.js',
                'theme-manager.js',
                'interactions.js',
                'csv-export.js'
            ];

            files.forEach(function (file) {
                var rel = base + file;
                var selector = 'script[src="' + rel + '"], script[src="' + rel.replace(/^\//, '') + '"]';
                if (document.querySelector(selector)) return;
                var s = document.createElement('script');
                s.src = rel;
                s.defer = true;
                document.head.appendChild(s);
            });
        })();
    </script>
</HeadContent>

<div class="page">
    <!-- Theme Toggle Button - positioned for login page -->
    <button title="Toggle theme" class="login-theme-toggle" data-theme-toggle aria-label="Switch theme">
        <span class="theme-light-icon">ðŸŒž</span>
        <span class="theme-dark-icon">ðŸŒ™</span>
    </button>
    
    <main>
        <article class="content px-4 page-fade-enter">
            @Body
        </article>
    </main>
    
    
    <!-- JavaScript files are loaded globally from index.html -->
</div>

<script>
    // Update theme toggle button icons based on current theme
    function updateLoginThemeToggleIcon() {
        const themeToggle = document.querySelector('.login-theme-toggle');
        if (!themeToggle) return;
        
        const lightIcon = themeToggle.querySelector('.theme-light-icon');
        const darkIcon = themeToggle.querySelector('.theme-dark-icon');
        
        if (!lightIcon || !darkIcon) return;
        
        // Get current theme from document attribute or localStorage
        const currentTheme = document.documentElement.getAttribute('data-theme') || 
                           localStorage.getItem('nexacrm-theme-preference') || 
                           'light';
        
        // Get system theme if theme is set to auto
        let effectiveTheme = currentTheme;
        if (currentTheme === 'auto') {
            effectiveTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // Update icon visibility based on effective theme
        if (effectiveTheme === 'dark') {
            lightIcon.style.display = 'inline';
            darkIcon.style.display = 'none';
            themeToggle.setAttribute('aria-label', 'Switch to light theme');
        } else {
            lightIcon.style.display = 'none';
            darkIcon.style.display = 'inline';
            themeToggle.setAttribute('aria-label', 'Switch to dark theme');
        }
        
        console.log('Login theme toggle icon updated for theme:', effectiveTheme);
    }
    
    // Ensure theme toggle works on login page
    document.addEventListener('DOMContentLoaded', function() {
        // Immediately update theme icon
        updateLoginThemeToggleIcon();
        
        // Wait a bit for all scripts to load, then setup listeners
        setTimeout(function() {
            if (window.themeManager && window.themeManager.setupThemeToggleListeners) {
                window.themeManager.setupThemeToggleListeners();
                console.log('Theme toggle listeners setup for login page');
            }
            
            // Update icon again after theme manager is initialized
            setTimeout(updateLoginThemeToggleIcon, 100);
        }, 500);
    });
    
    // Also setup on page show (for browser back/forward navigation)
    window.addEventListener('pageshow', function() {
        updateLoginThemeToggleIcon();
        
        setTimeout(function() {
            if (window.themeManager && window.themeManager.setupThemeToggleListeners) {
                window.themeManager.setupThemeToggleListeners();
            }
            updateLoginThemeToggleIcon();
        }, 100);
    });
    
    // Listen for theme changes to update icon
    window.addEventListener('themeChanged', function() {
        setTimeout(updateLoginThemeToggleIcon, 50);
    });
    
    // Listen for system theme changes (for auto mode)
    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function() {
            const currentTheme = localStorage.getItem('nexacrm-theme-preference') || 'auto';
            if (currentTheme === 'auto') {
                setTimeout(updateLoginThemeToggleIcon, 50);
            }
        });
    }
</script>
