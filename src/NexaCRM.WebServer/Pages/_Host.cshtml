@page "/"
@namespace NexaCRM.WebServer.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@using Microsoft.AspNetCore.Components.Web
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NexaCRM</title>
    <base href="~/" />
    <link href="_content/NexaCRM.UI/css/app.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/css/mobile.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/css/loading.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/NexaCRM.UI.bundle.scp.css" rel="stylesheet" />
    <link href="NexaCRM.WebServer.styles.css" rel="stylesheet" />
    <component type="typeof(HeadOutlet)" render-mode="ServerPrerendered" />
</head>
<body>
    <div id="nexacrm-initial-loader" role="status" aria-live="polite">
        <div class="loader-ring" aria-hidden="true"></div>
        <p class="loader-message">Preparing your NexaCRM workspace...</p>
    </div>
    <component type="typeof(App)" render-mode="Server" />
    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script>
        (function () {
            if (window.isDarkMode && window.isDarkMode._nexacrm_init) return;

            window.isDarkMode = window.isDarkMode || function () {
                const theme = document.documentElement.getAttribute('data-theme')
                    || localStorage.getItem('nexacrm-theme-preference')
                    || 'light';

                if (theme === 'dark') {
                    return true;
                }

                if (theme === 'auto') {
                    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                }

                return false;
            };

            // mark initialized to avoid later overwrites
            try { window.isDarkMode._nexacrm_init = true; } catch (e) { /* ignore */ }
        })();
    </script>
    <script src="js/loader.js"></script>
    <script src="_framework/blazor.server.js"></script>
    <script>
        (function () {
            if (window.__nexacrm_ui_scripts_loaded) return;
            window.__nexacrm_ui_scripts_loaded = true;

            var base = '_content/NexaCRM.UI/js/';
            var files = [
                'auth-manager.js',
                'navigation.js',
                'culture.js',
                'theme-manager.js',
                'device.js',
                'interactions.js',
                'csv-export.js'
            ];

            files.forEach(function (file) {
                var rel = base + file;
                var selector = 'script[src="' + rel + '"], script[src="/' + rel + '"]';
                if (document.querySelector(selector)) return;
                var s = document.createElement('script');
                s.src = rel;
                s.defer = true;
                document.head.appendChild(s);
            });
        })();
    </script>
</body>
</html>
