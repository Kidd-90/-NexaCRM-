<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>NexaCRM.WebClient</title>
    <base href="/" />
    <link href="_content/NexaCRM.UI/css/app.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/css/ui/index.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/css/common-page-styles.css" rel="stylesheet" />
    <link href="_content/NexaCRM.UI/NexaCRM.UI.bundle.scp.css" rel="stylesheet" />
    <link href="NexaCRM.WebClient.styles.css" rel="stylesheet" />
    <script src="https://tweakcn.com/live-preview.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
</head>

<body>
    <div id="app" style="display: flex; justify-content: center; align-items: center; height: 100vh;">
        <div class="loader"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script>
        (function () {
            if (window.isDarkMode && window.isDarkMode._nexacrm_init) return;

            window.isDarkMode = window.isDarkMode || function () {
                const theme = document.documentElement.getAttribute('data-theme') || localStorage.getItem('nexacrm-theme-preference') || 'light';
                if (theme === 'dark') return true;
                if (theme === 'auto') {
                    return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                }
                return false;
            };

            try { window.isDarkMode._nexacrm_init = true; } catch (e) { }
        })();
    </script>
    <!-- Diagnostic hook: capture uncaught errors and inspect storage/cookies before Blazor starts -->
    <script>
        (function () {
            function dumpDiagnosticInfo(prefix) {
                try {
                    console.groupCollapsed(prefix + ' â€” diagnostics');
                    try { console.log('document.cookie:', document.cookie); } catch (e) { console.log('cookie read failed', e); }
                    try {
                        const keys = Object.keys(localStorage || {});
                        console.log('localStorage keys:', keys);
                        ['nexacrm.supabase.session', 'nexacrm-theme-preference', 'dedupe-config', 'nexacrm.activeSubMenuIndex'].forEach(k => {
                            try {
                                const v = localStorage.getItem(k);
                                if (v === null) { console.log(k + ': <missing>'); return; }
                                console.log(k + ' raw:', v);
                                try { console.log(k + ' parsed JSON:', JSON.parse(v)); } catch (pe) { console.warn(k + ' JSON.parse failed', pe); }
                            } catch (e) { console.warn('read localStorage key failed', k, e); }
                        });
                    } catch (e) { console.warn('localStorage read failed', e); }
                    console.groupEnd();
                } catch (e) {
                    try { console.error('diagnostic dump failed', e); } catch { }
                }
            }

            window.addEventListener('error', function (ev) {
                try {
                    console.error('Window error event:', ev.error || ev.message || ev);
                    dumpDiagnosticInfo('error-event');
                } catch (e) { console.error('error handler failed', e); }
            });

            window.addEventListener('unhandledrejection', function (ev) {
                try {
                    console.error('Unhandled rejection:', ev.reason || ev);
                    dumpDiagnosticInfo('unhandledrejection');
                } catch (e) { console.error('unhandledrejection handler failed', e); }
            });

            // Also run a one-time dump immediately so values are visible even if no exception is thrown yet
            try { dumpDiagnosticInfo('startup'); } catch (e) { /* ignore*/ }
        })();
    </script>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="_content/NexaCRM.UI/js/auth-manager.js"></script>
    <script src="_content/NexaCRM.UI/js/navigation.js"></script>
    <script src="_content/NexaCRM.UI/js/culture.js"></script>
    <script src="_content/NexaCRM.UI/js/theme-manager.js"></script>
    <script src="_content/NexaCRM.UI/js/interactions.js"></script>
    <script src="_content/NexaCRM.UI/js/csv-export.js"></script>
</body>

</html>